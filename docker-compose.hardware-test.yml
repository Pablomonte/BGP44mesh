# Docker Compose Override for Hardware Test
# Provides macvlan network for ISP connectivity

version: '3.8'

services:
  tinc1:
    networks:
      mesh-net:
      cluster-net:
      isp-net:
        ipv4_address: 172.30.0.3
      lan-macvlan:
        ipv4_address: ${TINC1_LAN_IP:-172.30.0.100}
    extra_hosts:
      - "isp-bird:${ISP_NEIGHBOR:-172.30.0.1}"

  bird1:
    environment:
      - ISP_ENABLED=true
      - ISP_NEIGHBOR=${ISP_NEIGHBOR:-172.30.0.1}
      - ISP_LOCAL_IP=${ISP_LOCAL_IP:-172.30.0.100}

networks:
  lan-macvlan:
    driver: macvlan
    driver_opts:
      parent: ${LAN_INTERFACE:-eno1}
      macvlan_mode: bridge
    ipam:
      config:
        - subnet: ${LAN_SUBNET:-172.30.0.0/24}
          gateway: ${LAN_GATEWAY:-172.30.0.1}
          ip_range: ${LAN_IP_RANGE:-172.30.0.100/31}
